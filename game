#!/usr/bin/env bash
# Game Command Launcher
# Usage: ./game [command] [args]

set -e

GAME_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

case "$1" in
    "engineer")
        # Run the game-configured engineer
        shift
        cd "$GAME_ROOT/WORLD/engine"
        python3 game_agent.py "$@"
        ;;
    
    "test")
        # Test the integration
        cd "$GAME_ROOT"
        python3 WORLD/engine/test_game_state.py
        ;;
    
    "status")
        # Show current game state
        echo "=== GAME STATUS ==="
        echo ""
        if [ -f "$GAME_ROOT/RESUME.md" ]; then
            grep -E "^\*\*Build\*\*|^\*\*Tier\*\*|^\*\*Session\*\*|^\*\*Quest\*\*" "$GAME_ROOT/RESUME.md" | head -5
        else
            echo "No RESUME.md found"
        fi
        ;;
    
    "builds")
        # List available builds
        echo "=== AVAILABLE BUILDS ==="
        echo ""
        for build in warrior wizard ranger paladin rogue; do
            if [ -f "$GAME_ROOT/WORLD/builds/$build/build.json" ]; then
                name=$(grep '"name"' "$GAME_ROOT/WORLD/builds/$build/build.json" | head -1 | cut -d'"' -f4)
                tagline=$(grep '"tagline"' "$GAME_ROOT/WORLD/builds/$build/build.json" | head -1 | cut -d'"' -f4)
                echo "  $build - $name"
                echo "    $tagline"
                echo ""
            fi
        done
        ;;
    
    "help"|"")
        cat << 'EOF'
Game Command Launcher
=====================

Usage: ./game [command] [args]

Commands:
  engineer <project_dir>     Run game-configured engineer
  test                       Test the integration
  status                     Show current game state
  builds                     List available builds
  help                       Show this help

Examples:
  ./game engineer /tmp/my-project
  ./game engineer /tmp/my-project --max-iterations 5
  ./game test
  ./game status
  ./game builds

Before running engineer:
  1. Load a build: Tell Claude "load warrior build"
  2. Install dependencies: cd WORLD/engine/your-claude-engineer && pip install -r requirements.txt
  3. Configure .env: Copy .env.example and fill in your API keys
  4. Run: ./game engineer /path/to/project

EOF
        ;;
    
    *)
        echo "Unknown command: $1"
        echo "Run './game help' for usage"
        exit 1
        ;;
esac
